/*
This class facilites detecting the Java CDK target version via readCdkTargetVersion().
*/

import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.api.tasks.testing.Test
import java.util.Properties

class AirbyteJavaCdkPlugin implements Plugin<Project> {

    String CDK_VERSION_FILE = "airbyte-cdk/java/airbyte-cdk/core/src/main/resources/version.properties"

    String readCdkTargetVersion(Project project) {
        Properties cdkVersionProps = new Properties()
        project.file("${project.rootDir}/${CDK_VERSION_FILE}").withInputStream {
            cdkVersionProps.load(it)
        }
        return cdkVersionProps.getProperty('version') ?: 'undefined'
    }

    @Override
    void apply(Project project) {
        project.ext.getCdkTargetVersion = {
            return readCdkTargetVersion(project)
        }
    }
}
