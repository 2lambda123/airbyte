version: "0.1.0"

definitions:
  schema_loader:
    type: JsonFileSchemaLoader
    file_path: "./source_railz_ai/schemas/{{ options['schema_name'] or options['name'] }}.json"
  selector:
    extractor:
      field_pointer: ['data']
  selector_reports:
    extractor:
      field_pointer: ["{{ options['extractor_field'] or 'reports' }}"]
  requester:
    url_base: "https://api.railz.ai/"
    http_method: "GET"
    authenticator:
      class_name: source_railz_ai.components.AccessTokenAuthenticator
      client_id: "{{ config['client_id'] }}"
      secret_key: "{{ config['secret_key'] }}"
  retriever:
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: "DefaultPaginator"
      url_base: "*ref(definitions.requester.url_base)"
      page_size_option:
        inject_into: request_parameter
        field_name: "limit"
      pagination_strategy:
        type: "OffsetIncrement"
        page_size: 100
      page_token_option:
        inject_into: request_parameter
        field_name: "offset"
    requester:
      $ref: "*ref(definitions.requester)"

# Full Refresh Base:
  base_stream:
    primary_key: "id"
    retriever:
      $ref: "*ref(definitions.retriever)"
    schema_loader:
      $ref: "*ref(definitions.schema_loader)"
  businesses_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "businesses"
      path: "/businesses"
    primary_key: "businessName"
  connections_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "connections"
      path: "/connections"
    primary_key: "connectionId"

# Full Refresh Reports Without Parameter:
  base_reports_month_without_parameter_stream:
    $ref: "*ref(definitions.base_stream)"
    retriever:
      $ref: "*ref(definitions.base_stream.retriever)"
      class_name: source_railz_ai.components.RailzAiReportsRetriever
      record_selector:
        $ref: "*ref(definitions.selector_reports)"
  financial_benchmarking_stream: # ---- doesn't work yet -----
    $ref: "*ref(definitions.base_reports_month_without_parameter_stream)"
    $options:
      name: "financial_benchmarking"
      path: "/financialBenchmarking"
  tax_benchmarking_stream: # ---- doesn't work yet -----
    $ref: "*ref(definitions.base_reports_month_without_parameter_stream)"
    $options:
      name: "tax_benchmarking"
      path: "/taxBenchmarking"

# Full Refresh Service:
  base_service_stream:
    $ref: "*ref(definitions.base_stream)"
    retriever:
      $ref: "*ref(definitions.base_stream.retriever)"
      stream_slicer:
        class_name: source_railz_ai.components.RailzAiServiceSlicer
        parent_stream_config:
          stream: "*ref(definitions.businesses_stream)"
        service_names: "{{ options['service_names'] }}"
    transformations:
      - type: AddFields
        fields:
          - path:
              - "businessName"
            value: "{{ stream_slice['businessName'] }}"
          - path:
              - "serviceName"
            value: "{{ stream_slice['serviceName'] }}"
  customers_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "customers"
      path: "/customers"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "wave"
  accounts_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "accounts"
      path: "/accounts"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "wave"
        - "myob"
  inventory_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "inventory"
      path: "/inventory"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "wave"
  tax_rates_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "tax_rates"
      path: "/taxRates"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "dynamicsBusinessCentral"
  tracking_categories_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "tracking_categories"
      path: "/trackingCategories"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageIntacct"
  vendors_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "vendors"
      path: "/vendors"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "wave"
  bank_accounts_stream:
    $ref: "*ref(definitions.base_service_stream)"
    $options:
      name: "bank_accounts"
      path: "/bankAccounts"
      service_names:
        - "plaid"
    primary_key: "accountId"

# Base Datetime Options
  base_datetime_stream_slicer_options:
    start_datetime:
      datetime: "{{ config['start_date'] }}"
      datetime_format: "%Y-%m-%d"
    end_datetime:
      datetime: "{{ today_utc() }}"
      datetime_format: "%Y-%m-%d"
    datetime_format: "%Y-%m-%d"
    step: 1m
    start_time_option:
      field_name: startDate
      inject_into: "request_parameter"
    end_time_option:
      field_name: endDate
      inject_into: "request_parameter"
    cursor_field: "{{ options['stream_cursor_field'] }}"

# Incremental Base:
  base_incremental_stream:
    $ref: "*ref(definitions.base_stream)"
    retriever:
      $ref: "*ref(definitions.base_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_datetime_stream_slicer_options)"
        class_name: source_railz_ai.components.RailzAiIncrementalSlicer
    stream_cursor_field: "endDate"

# Incremental Reports Without Parameter:
  base_incremental_reports_without_parameter_stream:
    $ref: "*ref(definitions.base_stream)"
    retriever:
      $ref: "*ref(definitions.base_stream.retriever)"
      class_name: source_railz_ai.components.RailzAiIncrementalReportsRetriever
      meta_fields: "{{ options['meta_fields'] }}"
      record_selector:
        $ref: "*ref(definitions.selector_reports)"
      stream_slicer:
        $ref: "*ref(definitions.base_datetime_stream_slicer_options)"
        class_name: source_railz_ai.components.RailzAiIncrementalReportsSlicer
        step: 2m
        cursor_field: "{{ options['stream_cursor_field'] or 'endDate' }}"
    primary_key: ""

# Incremental Reports:
  base_incremental_reports_month_stream:
    $ref: "*ref(definitions.base_incremental_reports_without_parameter_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_reports_without_parameter_stream.retriever)"
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "month"
  base_incremental_reports_quarter_stream:
    $ref: "*ref(definitions.base_incremental_reports_month_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_reports_month_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_incremental_reports_without_parameter_stream.retriever.stream_slicer)"
        step: 6m
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "quarter"
  base_incremental_reports_year_stream:
    $ref: "*ref(definitions.base_incremental_reports_month_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_reports_month_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_incremental_reports_without_parameter_stream.retriever.stream_slicer)"
        step: 2y
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "year"

# Incremental Service:
  base_incremental_service_stream:
    $ref: "*ref(definitions.base_service_stream)"
    retriever:
      $ref: "*ref(definitions.base_service_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_service_stream.retriever.stream_slicer)"
        class_name: source_railz_ai.components.RailzAiIncrementalServiceSlicer
        base_datetime_stream_slicer_options:
          $ref: "*ref(definitions.base_datetime_stream_slicer_options)"
  accounting_transactions_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "accounting_transactions"
      path: "/accountingTransactions"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "myob"
      stream_cursor_field: "postedDate"
  bank_transfers_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "bank_transfers"
      path: "/bankTransfers"
      service_names:
        - "xero"
      stream_cursor_field: "date"
  bills_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "bills"
      path: "/bills"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
      stream_cursor_field: "postedDate"
  bills_credit_notes_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "bills_credit_notes"
      path: "/bills/creditNotes"
      service_names:
        - "quickbooks"
        - "xero"
        - "oracleNetsuite"
        - "sageIntacct"
      stream_cursor_field: "postedDate"
  bills_payments_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "bills_payments"
      path: "/bills/payments"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
      stream_cursor_field: "date"
  deposits_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "deposits"
      path: "/deposits"
      service_names:
        - "quickbooks"
        - "xero"
      stream_cursor_field: "postedDate"
  estimates_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "estimates"
      path: "/estimates"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "xero"
      stream_cursor_field: "postedDate"
  invoices_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "invoices"
      path: "/invoices"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
        - "wave"
      stream_cursor_field: "postedDate"
  invoices_credit_notes_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "invoices_credit_notes"
      path: "/invoices/creditNotes"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "xero"
        - "oracleNetsuite"
        - "dynamicsBusinessCentral"
      stream_cursor_field: "postedDate"
  invoices_payments_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "invoices_payments"
      path: "/invoices/payments"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
      stream_cursor_field: "date"
  journal_entries_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "journal_entries"
      path: "/journalEntries"
      service_names:
        - "freshbooks"
        - "quickbooks"
        - "quickbooksDesktop"
        - "xero"
        - "oracleNetsuite"
        - "sageBusinessCloud"
        - "sageIntacct"
      stream_cursor_field: "postedDate"
  purchase_orders_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "purchase_orders"
      path: "/purchaseOrders"
      service_names:
        - "quickbooks"
        - "xero"
        - "oracleNetsuite"
        - "sageIntacct"
        - "dynamicsBusinessCentral"
      stream_cursor_field: "postedDate"
  refunds_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "refunds"
      path: "/refunds"
      service_names:
        - "quickbooks"
        - "xero"
      stream_cursor_field: "date"
  bank_transactions_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "bank_transactions"
      path: "/bankTransactions"
      service_names:
        - "plaid"
      stream_cursor_field: "date"
  commerce_disputes_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "commerce_disputes"
      path: "/commerce/disputes"
      service_names:
        - "shopify"
        - "square"
      stream_cursor_field: "createdDate"
  commerce_orders_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "commerce_orders"
      path: "/commerce/orders"
      service_names:
        - "shopify"
        - "square"
      stream_cursor_field: "createdDate"
  commerce_products_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "commerce_products"
      path: "/commerce/products"
      service_names:
        - "shopify"
        - "square"
      stream_cursor_field: "createdDate"
  commerce_transactions_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    $options:
      name: "commerce_transactions"
      path: "/commerce/transactions"
      service_names:
        - "shopify"
        - "square"
      stream_cursor_field: "createdDate"

# Incremental Service Reports Without Parameter:
  base_incremental_service_reports_month_without_parameter_stream:
    $ref: "*ref(definitions.base_incremental_service_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_service_stream.retriever)"
      class_name: source_railz_ai.components.RailzAiIncrementalReportsRetriever
      meta_fields: "{{ options['meta_fields'] }}"
      record_selector:
        $ref: "*ref(definitions.selector_reports)"
      stream_slicer:
        $ref: "*ref(definitions.base_incremental_service_stream.retriever.stream_slicer)"
        class_name: source_railz_ai.components.RailzAiIncrementalServiceReportsSlicer
        base_datetime_stream_slicer_options:
          $ref: "*ref(definitions.base_incremental_service_stream.retriever.stream_slicer.base_datetime_stream_slicer_options)"
          step: 2m
          cursor_field: "{{ options['stream_cursor_field'] or 'endDate' }}"
    primary_key: ""
    stream_cursor_field: "endDate"
  bank_reconciliation_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream)"
    $options:
      name: "bank_reconciliation"
      path: "/bankReconciliation"
      service_names: []

# Incremental Service Reports:
  base_incremental_service_reports_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream.retriever)"
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "month"
  base_incremental_service_reports_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_service_reports_month_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream.retriever.stream_slicer)"
        base_datetime_stream_slicer_options:
          $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream.retriever.stream_slicer.base_datetime_stream_slicer_options)"
          step: 6m
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "quarter"
  base_incremental_service_reports_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_service_reports_month_stream.retriever)"
      stream_slicer:
        $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream.retriever.stream_slicer)"
        base_datetime_stream_slicer_options:
          $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream.retriever.stream_slicer.base_datetime_stream_slicer_options)"
          step: 2y
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "year"
  base_ap_aging_options:
    path: "/apAging"
    schema_name: "ap_aging"
    service_names:
      - "freshbooks"
      - "quickbooks"
      - "quickbooksDesktop"
      - "dynamicsBusinessCentral"
  ap_aging_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_ap_aging_options)"
      name: "ap_aging_month"
  ap_aging_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_ap_aging_options)"
      name: "ap_aging_quarter"
  ap_aging_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_ap_aging_options)"
      name: "ap_aging_year"
  base_ar_aging_options:
    path: "/arAging"
    schema_name: "ar_aging"
    service_names:
      - "freshbooks"
      - "quickbooks"
      - "quickbooksDesktop"
      - "sageIntacct"
      - "dynamicsBusinessCentral"
  ar_aging_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_ar_aging_options)"
      name: "ar_aging_month"
  ar_aging_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_ar_aging_options)"
      name: "ar_aging_quarter"
  ar_aging_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_ar_aging_options)"
      name: "ar_aging_year"
  base_balance_sheets_options:
    path: "/balanceSheets"
    schema_name: "balance_sheets"
    service_names:
      - "freshbooks"
      - "quickbooks"
      - "quickbooksDesktop"
      - "xero"
      - "dynamicsBusinessCentral"
      - "myob"
  balance_sheets_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_balance_sheets_options)"
      name: "balance_sheets_month"
  balance_sheets_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_balance_sheets_options)"
      name: "balance_sheets_quarter"
  balance_sheets_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_balance_sheets_options)"
      name: "balance_sheets_year"
  base_cashflow_statements_options:
    path: "/cashflowStatements"
    schema_name: "cashflow_statements"
    service_names:
      - "quickbooks"
      - "dynamicsBusinessCentral"
  cashflow_statements_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_cashflow_statements_options)"
      name: "cashflow_statements_month"
  cashflow_statements_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_cashflow_statements_options)"
      name: "cashflow_statements_quarter"
  cashflow_statements_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_cashflow_statements_options)"
      name: "cashflow_statements_year"
  base_income_statements_options:
    path: "/incomeStatements"
    schema_name: "income_statements"
    service_names:
      - "freshbooks"
      - "quickbooks"
      - "quickbooksDesktop"
      - "xero"
      - "dynamicsBusinessCentral"
      - "myob"
  income_statements_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_income_statements_options)"
      name: "income_statements_month"
  income_statements_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_income_statements_options)"
      name: "income_statements_quarter"
  income_statements_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_income_statements_options)"
      name: "income_statements_year"
  base_trial_balances_options:
    path: "/trialBalances"
    schema_name: "trial_balances"
    service_names:
      - "freshbooks"
      - "quickbooks"
      - "quickbooksDesktop"
      - "xero"
      - "oracleNetsuite"
      - "sageBusinessCloud"
      - "sageIntacct"
      - "dynamicsBusinessCentral"
      - "myob"
  trial_balances_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_trial_balances_options)"
      name: "trial_balances_month"
  trial_balances_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_trial_balances_options)"
      name: "trial_balances_quarter"
  trial_balances_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_trial_balances_options)"
      name: "trial_balances_year"
  base_fraud_risk_metrics_options:
    path: "/fraudRiskMetrics"
    schema_name: "fraud_risk_metrics"
    service_names: []
  fraud_risk_metrics_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_fraud_risk_metrics_options)"
      name: "fraud_risk_metrics_month"
  fraud_risk_metrics_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_fraud_risk_metrics_options)"
      name: "fraud_risk_metrics_quarter"
  fraud_risk_metrics_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_fraud_risk_metrics_options)"
      name: "fraud_risk_metrics_year"
  base_financial_ratios_options:
    path: "/financialRatios"
    schema_name: "financial_ratios"
    service_names: []
    extractor_field: "ratios"
  financial_ratios_month_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_ratios_options)"
      name: "financial_ratios_month"
  financial_ratios_quarter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_quarter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_ratios_options)"
      name: "financial_ratios_quarter"
  financial_ratios_year_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_year_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_ratios_options)"
      name: "financial_ratios_year"

# Incremental Service Reports With financialStatementType Parameter
  base_incremental_service_reports_with_financial_statement_type_parameter_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_month_without_parameter_stream)"
    retriever:
      $ref: "*ref(definitions.base_incremental_service_stream.retriever)"
      requester:
        $ref: "*ref(definitions.requester)"
        request_options_provider:
          request_parameters:
            reportFrequency: "{{ options['request_parameters']['report_frequency'] }}"
            financialStatementType: "{{ options['request_parameters']['financial_statement_type'] }}"
  base_financial_forecasts_options:
    path: "/financialForecasts"
    schema_name: "financial_forecasts"
    service_names: []
  financial_forecasts_month_balance_sheets_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_month_balance_sheets"
      request_parameters:
        report_frequency: "month"
        financial_statement_type: "balanceSheets"
  financial_forecasts_month_income_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_month_income_statements"
      request_parameters:
        report_frequency: "month"
        financial_statement_type: "incomeStatements"
  financial_forecasts_month_cashflow_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_month_cashflow_statements"
      request_parameters:
        report_frequency: "month"
        financial_statement_type: "cashflowStatements"
  financial_forecasts_quarter_balance_sheets_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_quarter_balance_sheets"
      request_parameters:
        report_frequency: "quarter"
        financial_statement_type: "balanceSheets"
  financial_forecasts_quarter_income_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_quarter_income_statements"
      request_parameters:
        report_frequency: "quarter"
        financial_statement_type: "incomeStatements"
  financial_forecasts_quarter_cashflow_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_quarter_cashflow_statements"
      request_parameters:
        report_frequency: "quarter"
        financial_statement_type: "cashflowStatements"
  financial_forecasts_year_balance_sheets_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_year_balance_sheets"
      request_parameters:
        report_frequency: "year"
        financial_statement_type: "balanceSheets"
  financial_forecasts_year_income_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_year_income_statements"
      request_parameters:
        report_frequency: "year"
        financial_statement_type: "incomeStatements"
  financial_forecasts_year_cashflow_statements_stream:
    $ref: "*ref(definitions.base_incremental_service_reports_with_financial_statement_type_parameter_stream)"
    $options:
      $ref: "*ref(definitions.base_financial_forecasts_options)"
      name: "financial_forecasts_year_cashflow_statements"
      request_parameters:
        report_frequency: "year"
        financial_statement_type: "cashflowStatements"

streams:
# Full Refresh
  - "*ref(definitions.businesses_stream)"
  - "*ref(definitions.connections_stream)"
# Full Refresh Reports
#  - "*ref(definitions.financial_benchmarking_stream)"
#  - "*ref(definitions.tax_benchmarking_stream)"
# Full Refresh Service
  - "*ref(definitions.customers_stream)"
#  - "*ref(definitions.attachments_stream)" # works through webhooks only
  - "*ref(definitions.accounts_stream)"
  - "*ref(definitions.inventory_stream)"
  - "*ref(definitions.tax_rates_stream)"
  - "*ref(definitions.tracking_categories_stream)"
  - "*ref(definitions.vendors_stream)"
  - "*ref(definitions.bank_accounts_stream)"
# Incremental Service
  - "*ref(definitions.accounting_transactions_stream)"
  - "*ref(definitions.bank_transfers_stream)"
  - "*ref(definitions.bills_stream)"
  - "*ref(definitions.bills_credit_notes_stream)"
  - "*ref(definitions.bills_payments_stream)"
  - "*ref(definitions.deposits_stream)"
  - "*ref(definitions.estimates_stream)"
  - "*ref(definitions.invoices_stream)"
  - "*ref(definitions.invoices_credit_notes_stream)"
  - "*ref(definitions.invoices_payments_stream)"
  - "*ref(definitions.journal_entries_stream)"
  - "*ref(definitions.purchase_orders_stream)"
  - "*ref(definitions.refunds_stream)"
  - "*ref(definitions.bank_transactions_stream)"
  - "*ref(definitions.commerce_disputes_stream)"
  - "*ref(definitions.commerce_orders_stream)"
  - "*ref(definitions.commerce_products_stream)"
  - "*ref(definitions.commerce_transactions_stream)"
# Incremental Service Reports Without Parameter:
#  - "*ref(definitions.bank_reconciliation_stream)" # doesn't support any service yet
# Incremental Service Reports
  - "*ref(definitions.ap_aging_month_stream)"
  - "*ref(definitions.ap_aging_quarter_stream)"
  - "*ref(definitions.ap_aging_year_stream)"
  - "*ref(definitions.ar_aging_month_stream)"
  - "*ref(definitions.ar_aging_quarter_stream)"
  - "*ref(definitions.ar_aging_year_stream)"
  - "*ref(definitions.balance_sheets_month_stream)"
  - "*ref(definitions.balance_sheets_quarter_stream)"
  - "*ref(definitions.balance_sheets_year_stream)"
  - "*ref(definitions.cashflow_statements_month_stream)"
  - "*ref(definitions.cashflow_statements_quarter_stream)"
  - "*ref(definitions.cashflow_statements_year_stream)"
  - "*ref(definitions.income_statements_month_stream)"
  - "*ref(definitions.income_statements_quarter_stream)"
  - "*ref(definitions.income_statements_year_stream)"
  - "*ref(definitions.trial_balances_month_stream)"
  - "*ref(definitions.trial_balances_quarter_stream)"
  - "*ref(definitions.trial_balances_year_stream)"
#  - "*ref(definitions.fraud_risk_metrics_month_stream)" # (this and every below) don't support any service yet
#  - "*ref(definitions.fraud_risk_metrics_quarter_stream)"
#  - "*ref(definitions.fraud_risk_metrics_year_stream)"
#  - "*ref(definitions.financial_ratios_month_stream)"
#  - "*ref(definitions.financial_ratios_quarter_stream)"
#  - "*ref(definitions.financial_ratios_year_stream)"
# Incremental Service Reports With financialStatementType Parameter
#  - "*ref(definitions.financial_forecasts_month_balance_sheets_stream)"
#  - "*ref(definitions.financial_forecasts_month_income_statements_stream)"
#  - "*ref(definitions.financial_forecasts_month_cashflow_statements_stream)"
#  - "*ref(definitions.financial_forecasts_quarter_balance_sheets_stream)"
#  - "*ref(definitions.financial_forecasts_quarter_income_statements_stream)"
#  - "*ref(definitions.financial_forecasts_quarter_cashflow_statements_stream)"
#  - "*ref(definitions.financial_forecasts_year_balance_sheets_stream)"
#  - "*ref(definitions.financial_forecasts_year_income_statements_stream)"
#  - "*ref(definitions.financial_forecasts_year_cashflow_statements_stream)"

check:
  stream_names:
    - "businesses"
