version: "0.1.0"

definitions:
  page_size: 250
  step: "100d"
  selector:
    extractor:
      field_pointer: ["bills"]
  requester:
    url_base: "https://api.congress.gov"
    http_method: "GET"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['api_key'] }}"
  retriever:
    stream_slicer:
      type: "DatetimeStreamSlicer"
      start_datetime:
        datetime: "{{ config['start_time'] }}"
        datetime_format: "%Y-%m-%d %H:%M:%S"
      end_datetime:
        datetime: "2022-10-17 00:00:00"
        datetime_format: "%Y-%m-%d %H:%M:%S"
      step: "*ref(definitions.step)"
      cursor_field: "{{ options.stream_cursor_field }}"
      start_time_option:
        field_name: "fromDateTime"
        inject_into: "request_parameter"
      end_time_option:
        field_name: "toDateTime"
        inject_into: "request_parameter"
      datetime_format: "%Y-%m-%dT%H:%M:%SZ"
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: DefaultPaginator
      $options:
        url_base: "*ref(definitions.requester.url_base)"
        page_size: "*ref(definitions.page_size)"
      page_size_option:
        inject_into: "request_parameter"
        field_name: "limit"
      page_token_option:
        inject_into: "request_parameter"
        field_name: "offset"
      pagination_strategy:
        type: "OffsetIncrement"
    requester:
      $ref: "*ref(definitions.requester)"
      request_options_provider:
        request_parameters:
          api_key: "{{ config['api_key'] }}"
          sort: "updateDate+asc"
  base_stream:
    retriever:
      $ref: "*ref(definitions.retriever)"
  bills_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "bills"
      primary_key: "id"
      stream_cursor_field: "updateDateIncludingText"
      path: "v3/bill"

streams:
  - "*ref(definitions.bills_stream)"

check:
  stream_names:
    - "bills"
