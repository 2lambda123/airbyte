rates_stream:
  options:
    name: "rates"
    primary_key: ""
    url_base: "https://api.exchangeratesapi.io/v1/"
    schema_loader:
      file_path: "./source_exchange_rates_tutorial/schemas/{{name}}.json"
    retriever:
      requester:
        path: "{{ stream_slice.start_date }}"
        request_options_provider:
          request_parameters:
            access_key: "{{ config.access_key }}"
            base: "{{ config.base }}"
      record_selector:
        extractor:
          transform: "[_]"
      stream_slicer:
        type: "DatetimeStreamSlicer"
        start_datetime:
          datetime: "{{ config.start_date }}"
          datetime_format: "%Y-%m-%d"
        end_datetime:
          datetime: "{{ now_local() }}"
          datetime_format: "%Y-%m-%d %H:%M:%S.%f"
        step: "1d"
        cursor_field: "date"
        datetime_format: "%Y-%m-%d"

streams:
  - "*ref(rates_stream)"
check:
  stream_names:
    - "rates"
