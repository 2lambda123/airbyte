limit: 100
lists_stream:
  options:
    name: "bounces"
    primary_key: email
    url_base: "https://api.sendgrid.com"
    schema_loader:
      file_path: "./source_sendgrid/schemas/{{options.name}}.json"
    retriever:
      paginator:
        type: "OffsetPaginator"
        page_size: "*ref(limit)"
      requester:
        path: "v3/suppression/bounces"
        request_options_provider:
          request_parameters:
            offset: "{{ next_page_token['offset'] }}"
            limit: "*ref(limit)"
        authenticator:
          type: "TokenAuthenticator"
          token: "{{ config.apikey }}"
      record_selector:
        extractor:
          transform: "_"
      stream_slicer:
        type: "DatetimeStreamSlicer"
        start_time: "2017-01-01"
        end_time: "2022-01-01"
        step: "1000d"
        cursor_field: "created"
        datetime_format: "%Y-%m-%d"
        request_options_provider:
          request_parameters:
            start_time: "{{ timestamp(start_time) }}"
            end_time: "{{ timestamp(end_time) }}"
streams:
  - "*ref(lists_stream)"
check:
  stream_names:
    - "bounces"
