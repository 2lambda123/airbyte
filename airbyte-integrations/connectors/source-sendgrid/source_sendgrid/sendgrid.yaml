spec:
  "documentationUrl": "https://docs.airbyte.io/integrations/sources/sendgrid"
  "connectionSpecification":
    "$schema": "http://json-schema.org/draft-07/schema#"
    "title": "Sendgrid Spec"
    "type": "object"
    "required": ["apikey"]
    "additionalProperties": false
    "properties":
      "apikey":
        "type": "string"
        "description": 'API Key, use <a href="https://app.sendgrid.com/settings/api_keys/">admin</a> to generate this key.'
      "start_time":
        "type": "integer"
        "description": "Start time in timestamp integer format. Any data before this timestamp will not be replicated."
        "examples": [1558359837]

source:
  class_name: "airbyte_cdk.sources.cac.configurable_source.ConfigurableSource"
  options:
    check:
      # TODO: add CheckStream to checks.__init__
      class_name: "airbyte_cdk.sources.cac.checks.check_stream.CheckStream"
      options:
        stream:
          class_name: "airbyte_cdk.sources.cac.configurable_stream.ConfigurableStream"
          vars:
            data_field: "results"
          options:
            name: segments
            schema:
              class_name: "airbyte_cdk.sources.cac.schema.json_schema.JsonSchema"
              options:
                file_path: "/Users/alex/code/airbyte/airbyte-integrations/connectors/source-sendgrid/schemas/segments.json"
            retriever:
              class_name: "airbyte_cdk.sources.cac.retrievers.simple_retriever.SimpleRetriever"
              options:
                iterator:
                  class_name: "airbyte_cdk.sources.cac.iterators.only_once.OnlyOnceIterator"
                state:
                  class_name: "airbyte_cdk.sources.cac.states.no_state.NoState"
                requester:
                  class_name: "airbyte_cdk.sources.cac.requesters.http_requester.HttpRequester"
                  options:
                    url_base: "https://api.sendgrid.com/v3/"
                    path: "marketing/segments"
                    method: GET
                    authenticator:
                      class_name: "airbyte_cdk.sources.streams.http.auth.token.TokenAuthenticator"
                      options:
                        token: "{{ config['apikey'] }}"
                extractor:
                  class_name: "airbyte_cdk.sources.cac.extractors.jq.JqExtractor"
                  options:
                    transform: ".{{ vars['data_field'] }}[]"
    streams:
      segments:
        class_name: "airbyte_cdk.sources.cac.configurable_stream.ConfigurableStream"
        vars:
          data_field: "results"
        options:
          name: segments
          schema:
            class_name: "airbyte_cdk.sources.cac.schema.json_schema.JsonSchema"
            options:
              file_path: "/Users/alex/code/airbyte/airbyte-integrations/connectors/source-sendgrid/source_sendgrid/schemas/segments.json"
          retriever:
            class_name: "airbyte_cdk.sources.cac.retrievers.simple_retriever.SimpleRetriever"
            options:
              iterator:
                class_name: "airbyte_cdk.sources.cac.iterators.only_once.OnlyOnceIterator"
              state:
                class_name: "airbyte_cdk.sources.cac.states.no_state.NoState"
              #iterator:
              #  class_name: "airbyte_cdk.sources.cac.iterators.datetime_iterator.DatetimeIterator"
              #  options:
              #    start_time:
              #      value: "{{ stream_state['date'] }}"
              #      default: "{{ config['start_date'] }}"
              #    end_time:
              #      value: "{{ today_utc() }}"
              #state:
              #  class_name: "airbyte_cdk.sources.cac.states.dict_state.DictState"
              #  options:
              #    name: "date"
              #    value: "{{ last_record[''] }}"
              requester:
                class_name: "airbyte_cdk.sources.cac.requesters.http_requester.HttpRequester"
                options:
                  url_base: "https://api.sendgrid.com/v3/"
                  path: "marketing/segments"
                  method: GET
                  authenticator:
                    class_name: "airbyte_cdk.sources.streams.http.auth.token.TokenAuthenticator"
                    options:
                      token: "{{ config.apikey }}"
              extractor:
                class_name: "airbyte_cdk.sources.cac.extractors.jq.JqExtractor"
                options:
                  transform: ".{{ vars['data_field'] }}[]"
