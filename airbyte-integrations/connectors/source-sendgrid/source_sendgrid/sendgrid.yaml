schema_loader:
  type: JsonSchema
  file_path: "./source_sendgrid/schemas/{{ options.name }}.json"
result_selector:
  type: RecordSelector
  extractor:
    type: JelloExtractor
    transform: "_.result"
requester:
  type: HttpRequester
  name: "{{ options['name'] }}"
  url_base: "https://api.sendgrid.com"
  http_method: "GET"
  authenticator:
    type: "BearerAuthenticator"
    token: "{{ config.apikey }}"
retriever:
  type: SimpleRetriever
  name: "{{ options['name'] }}"
  primary_key: "{{ options['primary_key'] }}"
  paginator:
    type: LimitPaginator
    url_base: "*ref(requester.url_base)"
    page_size: 100
    limit_option:
      inject_into: "request_parameter"
      field_name: "page_size"
    page_token_option:
      inject_into: "path"
    pagination_strategy:
      type: "CursorPagination"
      cursor_value: "{{ response._metadata.next }}"

lists_stream:
  type: DeclarativeStream
  $options:
    name: "lists"
  primary_key: "id"
  schema_loader:
    $ref: "*ref(schema_loader)"
  retriever:
    $ref: "*ref(retriever)"
    record_selector:
      $ref: "*ref(result_selector)"
    requester:
      $ref: "*ref(requester)"
      path: "/v3/marketing/lists"
campaigns_stream:
  type: DeclarativeStream
  $options:
    name: "campaigns"
  primary_key: "id"
  schema_loader:
    $ref: "*ref(schema_loader)"
  retriever:
    $ref: "*ref(retriever)"
    record_selector:
      $ref: "*ref(result_selector)"
    requester:
      $ref: "*ref(requester)"
      path: "/v3/marketing/campaigns"
streams:
  - "*ref(lists_stream)"
  - "*ref(campaigns_stream)"
check:
  type: CheckStream
  stream_names: ["lists"]
