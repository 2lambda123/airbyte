lists_stream:
  options:
    name: "lists"
    primary_key: id
    url_base: "https://api.sendgrid.com"
    schema_loader:
      file_path: "./source_sendgrid/schemas/{{options.name}}.json"
    retriever:
      paginator:
        type: "NextPageUrlPaginator"
        next_page_token_template:
          next_page_token: "{{ decoded_response._metadata.next}}"
      requester:
        path:
          class_name: "airbyte_cdk.sources.declarative.interpolation.interpolated_string.InterpolatedString"
          string: "{{ next_page_token['next_page_url'] }}"
          default: "/v3/marketing/lists"
        authenticator:
          type: "TokenAuthenticator"
          token: "{{ config.apikey }}"
        request_parameters_provider:
          page_size: 10
      extractor:
        transform: "_.result"

streams:
  - "*ref(lists_stream)"
check:
  stream_names:
    - "lists"
